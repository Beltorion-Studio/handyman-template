---
import Layout from '@layouts/Layout.astro'
import CTA from '@components/CTA.astro'
import heroImage from '@assets/images/plumbing.jpg'
import { getCollection } from 'astro:content'
import Hero from '@components/sections/Hero.astro'
import SectionWithText from '@components/sections/SectionWithText.astro'
import PostsSection from '@components/sections/PostsSection.astro'

// Get all services from content collection
const allServices = await getCollection('services')
const services = allServices.filter((service) => service.data.featured)

// Get testimonials from content collection
const testimonials = await getCollection('testimonial')

// Get blog posts from content collection
const allBlogPosts = await getCollection('blogs')
const blogPosts = allBlogPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
---

<Layout title="Home">
  <Hero
    sectionId="hero-section"
    heroImage={{ src: heroImage, alt: 'Hero background image' }}
    title="@@Plumbing@@ Services"
    subheading="Professional plumbing repairs, installations, and maintenance for your home. From leaky faucets to complete bathroom renovations, we handle it all with expertise and reliability."
    primaryButtonText="Get in Touch"
    primaryButtonHref="#contact"
  />

  <SectionWithText
    content={{
      sectionId: 'serviceOverview',
      title: 'Service Overview',
      description:
        'We deliver professional plumbing services with a focus on quality workmanship, reliable solutions, and customer satisfaction. Our team is equipped with the latest tools and techniques to handle any plumbing challenge efficiently and effectively.',
    }}
  />

  <CTA
    sectionId="Call to action"
    title="Get Your Plumbing Quote"
    description="Don't let plumbing problems disrupt your daily routine. Contact us today for a free estimate on your plumbing needs. Our experienced plumbers will assess your situation, provide expert recommendations, and deliver reliable plumbing solutions."
    primaryButtonText="Get Your Free Quote"
    primaryButtonHref="#contact"
    backgroundClass="bg-gradient-to-br from-brand to-primary-dark"
  />

  <PostsSection
    badge="And this is only part of it"
    title="Check Out What Else We Do"
    buttonText="View All Services"
    buttonHref="/services"
    posts={services}
    postType="services"
    maxPosts={3}
    sectionId="otherServices"
  />
</Layout>
