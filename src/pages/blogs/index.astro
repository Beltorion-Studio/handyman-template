---
import { getCollection } from 'astro:content'
import type { CollectionEntry } from 'astro:content'
import Layout from '@layouts/Layout.astro'
import heroImage from '@assets/images/locksmith.jpg'
import Hero from '@components/sections/Hero.astro'
import FeaturedBlogSection from '@components/sections/FeaturedBlogSection.astro'
import PostsSection from '@components/sections/PostsSection.astro'

// Get blog posts from content collection
const allBlogPosts = await getCollection('blogs')
const featuredPosts = allBlogPosts.filter((post: CollectionEntry<'blogs'>) => post.data.featured)
const nonFeaturedPosts = allBlogPosts.filter(
  (post: CollectionEntry<'blogs'>) => !post.data.featured
)
const sortedNonFeaturedPosts = nonFeaturedPosts.sort(
  (a: CollectionEntry<'blogs'>, b: CollectionEntry<'blogs'>) =>
    b.data.pubDate.getTime() - a.data.pubDate.getTime()
)
---

<Layout title="Home">
  <Hero
    heroImage={{ src: heroImage, alt: 'Hero background image' }}
    title="Blog"
    sectionId="hero-section"
  />

  <!-- Featured Blog Section Example -->
  {
    featuredPosts.length > 0 && (
      <FeaturedBlogSection
        sectionId="featured-blog-section"
        post={featuredPosts[0]}
        postType="blog"
        readMoreText="Read more"
      />
    )
  }

  <PostsSection
    posts={sortedNonFeaturedPosts}
    postType="blog"
    sectionId="blog-posts"
    background="bg-gradient-to-br from-primary-light/5 to-brand/5"
  />
</Layout>
