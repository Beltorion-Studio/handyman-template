---
import Layout from '@layouts/Layout.astro'
import Hero from '@components/sections/Hero.astro'
import CTA from '@components/CTA.astro'
import ProcessTimeline from '@components/sections/ProcessTimeline.astro'
import { getCollection } from 'astro:content'
import { config } from '@config'
import type { CollectionEntry } from 'astro:content'

export async function getStaticPaths() {
  const services = await getCollection('services')
  return services.map((service) => ({
    params: { slug: service.id },
    props: { service },
  }))
}

type Props = {
  service: CollectionEntry<'services'>
}

const { service } = Astro.props

// Generate page title and description
const pageTitle = `${service.data.title} | ${config.site.name}`
---

<Layout title={pageTitle}>
  <Hero
    sectionId="service-hero"
    heroImage={{ src: service.data.heroImage, alt: service.data.imageAlt }}
    title={service.data.title}
    subheading={service.data.description}
    primaryButtonText="Get Free Quote"
    primaryButtonHref="#contact"
  />

  <ProcessTimeline
    sectionId="our-process"
    title={service.data.ourProcess.title}
    steps={Object.values(service.data.ourProcess.steps).map((step) => ({
      title: step.title,
      description: step.content,
      image: { src: service.data.heroImage, alt: service.data.imageAlt },
    }))}
  />

  <CTA
    sectionId="service-cta"
    title={`Ready to Get Started with ${service.data.title}?`}
    description="Contact us today for a free consultation and estimate. We're here to help bring your vision to life."
    primaryButtonText="Get Free Quote"
    primaryButtonHref="#contact"
    backgroundClass="bg-gradient-to-br from-brand to-primary-dark"
  />
</Layout>
