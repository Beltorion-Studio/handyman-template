---
import Layout from '@layouts/Layout.astro'
import Hero from '@components/sections/Hero.astro'
import CTA from '@components/CTA.astro'
import PostsSection from '@components/sections/PostsSection.astro'
import ContactUs from '@components/ContactUs.astro'
import { getCollection } from 'astro:content'
import { config } from '@config'
import type { CollectionEntry } from 'astro:content'

export async function getStaticPaths() {
  const services = await getCollection('services')
  return services.map((service) => ({
    params: { slug: service.id },
    props: { service },
  }))
}

type Props = {
  service: CollectionEntry<'services'>
}

const { service } = Astro.props

// Generate page title and description
const pageTitle = `${service.data.title} | ${config.site.name}`

// Get collections for PostsSection, Services, and TeamSection
const allBlogPosts = await getCollection('blog')
const blogPosts = allBlogPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())

const allServices = await getCollection('services')
const services = allServices.filter((service) => service.data.featured)
---

<Layout title={pageTitle}>
  <Hero
    sectionId="service-hero"
    heroImage={{ src: service.data.heroImage, alt: service.data.imageAlt }}
    title={service.data.title}
    subheading={service.data.description}
    primaryButtonText="Get Free Quote"
    primaryButtonHref="#contact"
  />

  <CTA
    sectionId="service-cta"
    title={`Ready to Get Started with ${service.data.title}?`}
    description="Contact us today for a free consultation and estimate. We're here to help bring your vision to life."
    primaryButtonText="Get Free Quote"
    primaryButtonHref="#contact"
    backgroundClass="bg-gradient-to-br from-brand to-primary-dark"
  />

  <PostsSection
    badge="And this is only part of it"
    title="Check Out What Else We Do"
    buttonText="View All Services"
    buttonHref="/services"
    posts={services}
    postType="service"
    maxPosts={3}
    sectionId="otherServices"
  />

  <ContactUs sectionId="contact" title="Let's Discuss Your Project" />
</Layout>
