---
import Layout from '@layouts/Layout.astro'
import Hero from '@components/sections/Hero.astro'
import SectionWithText from '@components/sections/SectionWithText.astro'
import SectionRegular from '@components/sections/SectionRegular.astro'
import SectionWithBullets from '@components/sections/SectionWithBullets.astro'
import SectionWithTrustStats from '@components/sections/SectionWithTrustStats.astro'
import CTA from '@components/CTA.astro'
import PostsSection from '@components/sections/PostsSection.astro'

import ProcessTimeline from '@components/services/ProcessTimeline.astro'
import CommonScenarios from '@components/services/CommonScenarios.astro'
import SectionWithThreeColumns from '@components/sections/SectionWithThreeColumns.astro'
import { getCollection } from 'astro:content'
import { config } from '@config'
import { slugify } from '@lib/utils/textFormatting'
import type { CollectionEntry } from 'astro:content'

import testImage from '@assets/images/installer-holding-shelf-w2000.jpg'

export async function getStaticPaths() {
  const services = await getCollection('services')
  return services.map((service) => ({
    params: { slug: service.id },
    props: { service },
  }))
}

type Props = {
  service: CollectionEntry<'services'>
}

const { service } = Astro.props

// Generate page title and description
const pageTitle = `${service.data.title} | ${config.site.name}`

// Get collections for PostsSection, Services, and TeamSection
const allBlogPosts = await getCollection('blogs')
const blogPosts = allBlogPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())

const allServices = await getCollection('services')
const services = allServices.filter((service) => service.data.featured)
---

<Layout title={pageTitle}>
  <Hero
    sectionId="service-hero"
    heroImage={{ src: service.data.heroImage, alt: service.data.imageAlt }}
    title={service.data.title}
    subheading={service.data.description}
    primaryButtonText="Get Free Quote"
    primaryButtonHref="/contact"
  />

  <SectionWithText
    content={{
      sectionId: slugify(service.data.serviceOverview.title),
      title: service.data.serviceOverview.title,
      description: service.data.serviceOverview.content,
    }}
  />

  <SectionRegular
    content={{
      sectionId: slugify(service.data.services.service1.title),
      background: 'from-primary-light/5 to-brand/5 overflow-x-clip bg-gradient-to-br',
      justifyContent: 'center',
      title: service.data.services.service1.title,
      paragraphs: {
        p1: service.data.services.service1.paragraphs.paragraph1,
        p2: service.data.services.service1.paragraphs.paragraph2,
      },
      image: {
        src: service.data.services.service1.image.src,
        alt: service.data.services.service1.image.alt,
        size: 'square',
      },
    }}
  />

  <SectionWithBullets
    content={{
      sectionId: slugify(service.data.services.service2.title),
      justifyContent: 'center',
      reverse: true,
      title: service.data.services.service2.title,
      paragraphs: {
        p1: service.data.services.service2.paragraphs.paragraph1,
      },
      image: {
        src: service.data.services.service2.image.src,
        alt: service.data.services.service2.image.alt,
        size: 'square',
      },
      bulletPoints: service.data.services.service2.bulletPoints,
      listType: 'bullets',
    }}
  />

  <SectionRegular
    content={{
      sectionId: slugify(service.data.services.service3.title),
      background: 'from-primary-light/5 to-brand/5 overflow-x-clip bg-gradient-to-br',
      justifyContent: 'center',
      title: service.data.services.service3.title,
      paragraphs: {
        p1: service.data.services.service3.paragraphs.paragraph1,
        p2: service.data.services.service3.paragraphs.paragraph2,
      },
      buttons: {
        primary: {
          text: 'Get Your Free Quote',
          href: '/contact',
        },
      },
      image: {
        src: service.data.services.service3.image.src,
        alt: service.data.services.service3.image.alt,
        size: 'square',
      },
    }}
  />

  <SectionWithBullets
    content={{
      sectionId: slugify(service.data.services.service4.title),
      justifyContent: 'center',
      reverse: true,
      title: service.data.services.service4.title,
      paragraphs: {
        p1: service.data.services.service4.paragraphs.paragraph1,
      },
      image: {
        src: service.data.services.service4.image.src,
        alt: service.data.services.service4.image.alt,
        size: 'square',
      },
      bulletPoints: service.data.services.service4.bulletPoints,
      listType: 'bullets',
    }}
  />

  <SectionRegular
    content={{
      sectionId: slugify(service.data.services.service5.title),
      background: 'from-primary-light/5 to-brand/5 overflow-x-clip bg-gradient-to-br',
      justifyContent: 'center',
      title: service.data.services.service5.title,
      paragraphs: {
        p1: service.data.services.service5.paragraphs.paragraph1,
        p2: service.data.services.service5.paragraphs.paragraph2,
      },
      image: {
        src: service.data.services.service5.image.src,
        alt: service.data.services.service5.image.alt,
        size: 'square',
      },
    }}
  />

  <ProcessTimeline
    sectionId="our-process"
    title={service.data.ourProcess.title}
    steps={Object.values(service.data.ourProcess.steps).map((step) => ({
      title: step.title,
      description: step.content,
      image: { src: service.data.heroImage, alt: service.data.imageAlt },
    }))}
  />

  <CommonScenarios
    sectionId="common-scenarios"
    title={service.data.common.title}
    cards={service.data.common.cards}
  />

  <CTA
    sectionId="service-cta"
    title={`Ready to Get Started with ${service.data.title}?`}
    description="Contact us today for a free consultation and estimate. We're here to help bring your vision to life."
    primaryButtonText="Get Free Quote"
    primaryButtonHref="#contact"
    backgroundClass="bg-gradient-to-br from-brand to-primary-dark"
  />

  <SectionWithThreeColumns
    sectionId="three-columns-section"
    title={service.data.threeColumnsSection.title}
    columns={[
      {
        title: service.data.threeColumnsSection.column1.title,
        items: service.data.threeColumnsSection.column1.items,
        iconColor: 'brand',
      },
      {
        title: service.data.threeColumnsSection.column2.title,
        items: service.data.threeColumnsSection.column2.items,
        iconColor: 'brand',
      },
      {
        title: service.data.threeColumnsSection.column3.title,
        items: service.data.threeColumnsSection.column3.items,
        iconColor: 'brand',
      },
    ]}
  />

  <CTA
    sectionId={slugify(service.data.cta.title)}
    title={service.data.cta.title}
    description={service.data.cta.content}
    primaryButtonText={service.data.cta.button}
    primaryButtonHref="#contact"
    backgroundClass="bg-gradient-to-br from-brand to-primary-dark"
  />
  <SectionWithTrustStats
    content={{
      sectionId: slugify(service.data.serviceAreas.title),
      title: service.data.serviceAreas.title,
      statsTextSize: 'text-2xl',
      paragraphs: {
        p1: service.data.serviceAreas.content,
        p2: 'Call us now or schedule online - We are here when you need us most!',
      },
      buttons: {
        primary: {
          text: 'Call Us Now',
          href: '/contact',
        },
      },
      trustStats: [
        {
          value: 'Emergency Service',
          label: service.data.serviceAreas.scheduling.consultations,
        },
        {
          value: 'Weekend Service',
          label: service.data.serviceAreas.scheduling.weekendProjects,
        },
        {
          value: 'Standard Appointments',
          label: service.data.serviceAreas.scheduling.standardHours,
        },
        {
          value: 'Commercial Hours',
          label: service.data.serviceAreas.scheduling.seasonalWork,
        },
      ],
    }}
  />

  <PostsSection
    badge="And this is only part of it"
    title="Check Out What Else We Do"
    buttonText="View All Services"
    buttonHref="/services"
    posts={services}
    postType="services"
    maxPosts={3}
    sectionId="otherServices"
  />
</Layout>
