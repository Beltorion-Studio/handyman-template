---
import type { HTMLTag } from 'astro/types'
import { cva, type VariantProps } from 'cva'
import { formatText, type TextStyle } from '@lib/utils/textFormatting'

const headingVariants = cva(
  // Base styles applied to all headings
  'font-bold text-pretty',
  {
    variants: {
      variant: {
        primary: 'text-primary',
        secondary: 'text-secondary',
        brand: 'text-brand',
        white: 'text-white',
        black: 'text-black',
        gradient: 'bg-gradient-to-r from-black to-gray-700 bg-clip-text text-transparent',
      },
      size: {
        h1: 'text-3xl/tight tablet:text-7xl/tight',
        h2: 'text-2xl/snug tablet:text-4xl/snug',
        h3: 'text-xl/snug tablet:text-2xl/snug',
        h4: 'text-lg/snug tablet:text-xl/snug',
        h5: 'text-lg/snug tablet:text-lg/snug',
        h6: 'text-base/snug tablet:text-base/snug',
      },
      weight: {
        normal: 'font-normal',
        medium: 'font-medium',
        bold: 'font-bold',
      },
      align: {
        left: 'text-left',
        center: 'text-center',
        right: 'text-right',
        leftCenter: 'text-center tablet:text-left',
      },
      lineHeight: {
        none: '!leading-none',
        tight: '!leading-tight',
        snug: '!leading-snug',
        normal: '!leading-normal',
        relaxed: '!leading-relaxed',
        loose: '!leading-loose',
      },
      bottomSpacing: {
        none: 'mb-0',
        tight: 'mb-2',
        normal: 'mb-4',
        relaxed: 'mb-6',
        loose: 'mb-8',
        custom: 'mb-10 mt-4',
      },
      maxWidth: {
        'none': '',
        'xs': 'max-w-xs',
        'sm': 'max-w-sm',
        'md': 'max-w-md',
        'lg': 'max-w-lg',
        'xl': 'max-w-xl',
        '2xl': 'max-w-2xl',
        '3xl': 'max-w-3xl',
        '4xl': 'max-w-4xl',
        '5xl': 'max-w-5xl',
        '6xl': 'max-w-6xl',
        '7xl': 'max-w-7xl',
        'prose': 'max-w-prose',
        'prose-sm': 'max-w-prose-sm',
        'prose-lg': 'max-w-prose-lg',
        'prose-xl': 'max-w-prose-xl',
        'prose-2xl': 'max-w-prose-2xl',
      },
    },
    defaultVariants: {
      variant: 'primary',
      weight: 'bold',
      align: 'left',
      bottomSpacing: 'normal',
    },
  }
)

export type Props = VariantProps<typeof headingVariants> & {
  tag: HTMLTag
  class?: string
  id?: string
  text?: string
  textStyles?: TextStyle
  enableTextFormatting?: boolean
}

const {
  tag,
  size,
  variant,
  weight,
  align,
  bottomSpacing,
  lineHeight,
  maxWidth,
  class: className,
  id,
  text,
  textStyles,
  enableTextFormatting = true,
  ...props
} = Astro.props as Props

// If size is not provided, default to the tag name as size
const headingSize = size || (tag as 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6')

const Tag = tag

// Process text formatting if enabled and text is provided
const processedText = text && enableTextFormatting ? formatText(text, textStyles) : text
---

<Tag
  {...props}
  id={id}
  class:list={[
    headingVariants({
      variant,
      size: headingSize,
      weight,
      align,
      bottomSpacing,
      lineHeight,
      maxWidth,
    }),
    className,
  ]}
  set:html={processedText}
>
  {!text && <slot />}
</Tag>
