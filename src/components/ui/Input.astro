---
import { z } from 'zod'

const PropsSchema = z.object({
  type: z.enum(['text', 'email', 'tel', 'password']).optional().default('text'),
  name: z.string(),
  id: z.string(),
  placeholder: z.string(),
  required: z.boolean().optional().default(false),
  disabled: z.boolean().optional().default(false),
  value: z.string().optional(),
  label: z.string().optional(),
  error: z.string().optional(),
  className: z.string().optional(),
})

export type Props = z.infer<typeof PropsSchema>

const {
  type = 'text',
  name,
  id,
  placeholder,
  required = false,
  disabled = false,
  value,
  label,
  error,
  className = '',
} = PropsSchema.parse(Astro.props)

const inputId = id || name
const hasError = Boolean(error)
---

<div class={`flex flex-col gap-2 ${className}`}>
  {
    label && (
      <label for={inputId} class="text-base leading-[1.4] font-bold text-white">
        {label}
        {required && <span class="ml-1 text-red-400">*</span>}
      </label>
    )
  }

  <div class="relative">
    <input
      type={type}
      id={inputId}
      name={name}
      placeholder={placeholder}
      required={required}
      disabled={disabled}
      value={value}
      class={`
        w-full px-3 py-3 bg-white rounded border-2 transition-colors duration-200
        text-base text-sky-900 placeholder-sky-600
        focus:outline-none focus:ring-2 focus:ring-cyan-300 focus:border-transparent
        disabled:opacity-50 disabled:cursor-not-allowed
        ${hasError ? 'border-red-500 focus:ring-red-300' : 'border-sky-600 focus:border-sky-600'}
      `}
      aria-invalid={hasError}
      aria-describedby={hasError ? `${inputId}-error` : undefined}
    />

    {
      hasError && (
        <div
          id={`${inputId}-error`}
          class="absolute -bottom-6 left-0 text-sm text-red-400"
          role="alert"
        >
          {error}
        </div>
      )
    }
  </div>
</div>
