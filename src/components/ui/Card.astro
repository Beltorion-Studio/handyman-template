---
import { cva } from 'cva'
import { z } from 'zod'
import { Icon } from 'astro-icon/components'
import type { IconName } from '@lib/icons'

const card = cva('bg-white relative rounded-3xl size-full', {
  variants: {
    defaults: {
      default: [
        'transition',
        'duration-300',
        'hover:shadow-lg',
        'border',
        'border-brand',
        'border-solid',
      ],
    },
    intent: {
      default: ['border-brand'],
      primary: ['border-primary-dark'],
      secondary: ['border-secondary'],
    },
    padding: {
      small: ['p-6'],
      medium: ['p-8'],
      large: ['p-10'],
    },
  },
  compoundVariants: [{ intent: 'default', padding: 'medium' }],
})

const PropsSchema = z
  .object({
    intent: z.enum(['default', 'primary', 'secondary']).optional(),
    padding: z.enum(['small', 'medium', 'large']).optional(),
    defaults: z.enum(['default']).optional(),
    title: z.string().optional(),
    description: z.string().optional(),
    icon: z.string().optional(),
    iconAlt: z.string().optional(),
    href: z.string().optional(),
    ariaLabel: z.string().optional(),
  })
  .passthrough() // Allow additional props

export type Props = z.infer<typeof PropsSchema>

const {
  intent = 'default',
  padding = 'medium',
  defaults = 'default',
  title,
  description,
  icon,
  iconAlt,
  href,
  ariaLabel,
  ...rest
} = PropsSchema.parse(Astro.props)

const Element = href ? 'a' : 'div'
---

<Element
  {...rest}
  {...href ? { href } : {}}
  aria-label={ariaLabel}
  class:list={[card({ intent, padding, defaults }), 'm-0']}
>
  <div
    class="relative flex size-full flex-col content-stretch items-start justify-start overflow-clip"
  >
    <!-- Icon Section -->
    {
      icon && (
        <div class="relative box-border flex w-full shrink-0 content-stretch items-start justify-start overflow-clip">
          <div class="relative size-16 shrink-0">
            <Icon
              name={icon}
              title={iconAlt || title || 'Card icon'}
              class="block size-full text-current"
            />
          </div>
        </div>
      )
    }

    <!-- Content Section -->
    <div
      class="text-text-primary relative box-border flex w-full shrink-0 flex-col content-stretch items-start justify-start gap-4 leading-[0]"
    >
      {
        title && (
          <div class="relative w-full shrink-0 text-2xl font-bold">
            <p class="leading-normal">{title}</p>
          </div>
        )
      }
      {
        description && (
          <div class="relative w-full shrink-0 overflow-hidden text-base font-normal overflow-ellipsis">
            <p class="leading-[1.4]">{description}</p>
          </div>
        )
      }
    </div>
  </div>
</Element>
