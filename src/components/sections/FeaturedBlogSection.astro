---
import { Image } from 'astro:assets'
import { Icon } from 'astro-icon/components'
import Heading from '@components/ui/Heading.astro'
import Link from '@components/ui/Link.astro'

export type Props = {
  post?: {
    id: string
    data: {
      title: string
      description: string
      heroImage: any
      imageAlt: string
      pubDate?: Date
      category?: string
      featured?: boolean
    }
  }
  sectionId?: string
  readMoreText?: string
  postType?: 'blog' | 'services'
  className?: string
  background?: string
}

const {
  post,
  sectionId = 'featured-blog-section',
  readMoreText = 'Read more',
  postType = 'blog',
  className = '',
  background = 'bg-white',
} = Astro.props

// Generate post URL based on type
const getPostUrl = (id: string, type: string) => {
  return type === 'blog' ? `/blog/${id}` : `/services/${id}`
}

// Format date for display
const formatDate = (date: Date | undefined) => {
  if (!date) return undefined
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(date)
}

const postUrl = post ? getPostUrl(post.id, postType) : '#'
const formattedDate = post?.data.pubDate ? formatDate(post.data.pubDate) : undefined
---

<section 
  class={`pt-10 tablet:pt-28 ${background} ${className}`} 
  id={sectionId}
  aria-label="Featured blog post"
>
  <div class="container mx-auto px-4">
    {post ? (
      <div class="mx-auto w-full">
        <div class="overflow-hidden rounded-3xl border border-brand bg-white shadow-sm transition-shadow duration-300 hover:shadow-lg">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-20">
            <!-- Image Section -->
            <div class="relative h-full w-full">
              <Image
                src={post.data.heroImage}
                alt={post.data.imageAlt}
                class="h-full w-full object-cover"
                width={640}
                height={400}
              />
            </div>

            <!-- Content Section -->
            <div class="flex h-full w-full flex-col justify-between pr-6 py-6 lg:pr-8 lg:py-8">
              <div class="flex flex-col gap-4">
                <!-- Date -->
                {formattedDate && (
                  <p class="text-lg font-normal text-text-primary">
                    {formattedDate}
                  </p>
                )}

                <!-- Title -->
                <Heading
                  tag="h2"
                  size="h2"
                  variant="primary"
                  class="text-3xl font-bold leading-normal text-text-primary lg:text-4xl"
                >
                  {post.data.title}
                </Heading>

                <!-- Description -->
                <p class="text-base font-normal leading-relaxed text-text-primary lg:text-lg">
                  {post.data.description}
                </p>
              </div>

              <!-- Read More Link -->
              <div class="mt-6 lg:mt-8">
                <Link
                  href={postUrl}
                  intent="primary"
                  class="group inline-flex items-center gap-2 text-lg font-bold text-text-light transition-colors duration-200 hover:text-brand"
                  tabindex="0"
                  aria-label={`Read more about ${post.data.title}`}
                >
                  <span>{readMoreText}</span>
                  <Icon
                    name="quill:chevron-right"
                    class="h-6 w-6 transition-transform duration-200 group-hover:translate-x-1"
                  />
                </Link>
              </div>
            </div>
          </div>
        </div>
      </div>
    ) : (
      <div class="mx-auto max-w-[1280px] py-12 text-center">
        <p class="text-lg text-text-primary">No featured {postType} post available at the moment.</p>
      </div>
    )}
  </div>
</section>
