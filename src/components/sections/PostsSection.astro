---
import Heading from '@components/ui/Heading.astro'
import PostCard from '@components/PostCard.astro'
import Badge from '@components/ui/Badge.astro'
import Button from '@components/ui/Button.astro'
import type { ImageMetadata } from 'astro'

export type Props = {
  badge?: string
  title?: string
  description?: string
  buttonText?: string
  buttonHref?: string
  posts?: Array<{
    id: string
    data: {
      title: string
      description: string
      heroImage: ImageMetadata
      imageAlt: string
      pubDate?: Date
      category?: string
      featured?: boolean
    }
  }>
  sectionId: string
  readMoreText?: string
  maxPosts?: number
  showFeaturedOnly?: boolean
  postType?: 'blog' | 'services'
  className?: string
  background?: string
}

const {
  badge,
  title,
  description,
  buttonText,
  buttonHref,
  posts = [],
  sectionId = 'posts-section',
  readMoreText = 'Read More',
  maxPosts,
  showFeaturedOnly = false,
  postType = 'blog',
  className = '',
  background = 'bg-white',
} = Astro.props

// Filter and limit posts
const filteredPosts = posts
  .filter((post) => (showFeaturedOnly ? post.data.featured : true))
  .slice(0, maxPosts || posts.length)

// Generate post URLs based on type
const getPostUrl = (id: string, type: string) => {
  return type === 'blog' ? `/blog/${id}` : `/services/${id}`
}

// Format date for display
const formatDate = (date: Date | undefined) => {
  if (!date) return undefined
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(date)
}
---

<section class={`py-10 tablet:py-28 ${background} ${className}`} id={sectionId}>
  <div class="container mx-auto flex flex-col gap-12">
    <!-- Section Header -->
    <div class="flex items-end justify-between">
      <div class="flex flex-col items-start">
        {
          badge && (
            <Badge intent="secondary" roundness="sm" size="base" class="mb-4">
              {badge}
            </Badge>
          )
        }
        <Heading tag="h2" size="h2" variant="primary" align="left" bottomSpacing="none">
          {title}
        </Heading>
        {description && <p class="text-text-primary mt-4 max-w-2xl text-lg">{description}</p>}
      </div>
      <div class="flex h-full flex-col items-end">
        {
          buttonText && buttonHref && (
            <Button intent="primary" size="medium" borderRadius="corner" href={buttonHref}>
              {buttonText}
            </Button>
          )
        }
      </div>
    </div>

    <!-- Posts Grid -->
    {
      filteredPosts.length > 0 ? (
        <div class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3">
          {filteredPosts.map((post) => (
            <div class="h-full">
              <PostCard
                image={post.data.heroImage}
                imageAlt={post.data.imageAlt}
                date={formatDate(post.data.pubDate)}
                title={post.data.title}
                description={post.data.description}
                readMoreText={readMoreText}
                href={getPostUrl(post.id, postType)}
              />
            </div>
          ))}
        </div>
      ) : (
        <div class="py-12 text-center">
          <p class="text-text-primary text-lg">No {postType} posts available at the moment.</p>
        </div>
      )
    }
  </div>
</section>
