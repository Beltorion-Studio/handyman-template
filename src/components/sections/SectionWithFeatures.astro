---
import { Image } from 'astro:assets'
import { Icon } from 'astro-icon/components'
import Button from '@components/ui/Button.astro'
import Heading from '@components/ui/Heading.astro'
import Badge from '../ui/Badge.astro'
import { formatText } from '@lib/utils/textFormatting'
import type { SectionWithFeaturesContent } from '@types/section'

type Props = {
  content: SectionWithFeaturesContent
}

const { content } = Astro.props
---

<section
  class="tablet:py-28 py-10"
  aria-label="Section with features container"
  id={content.sectionId}
>
  <div class="container">
    <div class="desktop:grid-cols-2 grid items-start gap-20">
      <div
        class={`desktop:items-start h-full text-left flex flex-col items-center ${
          content.justifyContent === 'center' ? 'justify-center' : 'justify-start'
        } ${content.reverse ? 'order-2' : 'order-1'}`}
      >
        {
          content.badge && (
            <Badge intent="secondary" roundness="sm" size="base">
              {content.badge}
            </Badge>
          )
        }

        <Heading tag="h2">{content.title}</Heading>
        <div class="mb-8 flex flex-col">
          {
            Object.entries(content.paragraphs).map(([key, text]) => {
              void key
              return <p class="text-text-primary mt-4" set:html={formatText(text)} />
            })
          }
        </div>

        {
          content.features.length > 0 && (
            <div class="mb-8 w-full">
              <div
                class={`desktop:text-left text-center ${
                  content.featureLayout === 'grid'
                    ? 'grid grid-cols-1 gap-6 md:grid-cols-2'
                    : content.featureLayout === 'horizontal'
                      ? 'flex flex-col gap-6'
                      : 'space-y-6'
                }`}
              >
                {content.features.map((feature) => (
                  <div
                    class={`flex items-start gap-4 rounded-xl p-6 transition-all duration-300 ${
                      feature.highlight
                        ? 'bg-brand/5 border-brand/20 border'
                        : 'border border-gray-100 bg-gray-50'
                    }`}
                  >
                    {feature.icon && (
                      <div
                        class={`flex-shrink-0 rounded-lg p-3 ${
                          feature.highlight ? 'bg-brand text-white' : 'text-brand bg-white'
                        }`}
                      >
                        <Icon name={feature.icon} class="h-6 w-6" />
                      </div>
                    )}
                    <div class="flex-1">
                      <h4
                        class={`mb-2 text-lg font-semibold ${
                          feature.highlight ? 'text-brand' : 'text-text-primary'
                        }`}
                      >
                        {feature.title}
                      </h4>
                      <p class="text-text-primary text-base leading-relaxed">
                        {feature.description}
                      </p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )
        }

        {
          content.buttons && (
            <div class="tablet:flex-row desktop:justify-start flex w-full flex-col justify-center gap-4">
              {content.buttons.primary && (
                <Button
                  intent="primary"
                  size="medium"
                  borderRadius="corner"
                  href={content.buttons.primary.href}
                >
                  {content.buttons.primary.text}
                </Button>
              )}
              {content.buttons.secondary && (
                <Button
                  intent="outlined"
                  size="medium"
                  borderRadius="corner"
                  href={content.buttons.secondary.href}
                >
                  {content.buttons.secondary.text}
                </Button>
              )}
            </div>
          )
        }
      </div>

      {
        content.image.src && (
          <div class={`${content.reverse ? 'order-1' : 'order-2'} h-full w-full`}>
            <Image
              src={content.image.src}
              alt={content.image.alt}
              class={`w-full rounded-3xl object-cover ${
                content.image.size ? `aspect-${content.image.size}` : 'h-full'
              } ${content.image.position === 'middle' ? 'self-center' : 'self-start'}`}
            />
          </div>
        )
      }
    </div>
  </div>
</section>
